#!/usr/bin/env python

from pprint import pprint

import arguments
import initialt
import journalt
import chartt
import balancet
import treet

import budgett

import summary
import summary_budget

import ministryt

import report_bills
import report_subfunds
import report_ministry
import report_vendors

################################################################


def main():

    # pylint: disable=too-many-branches

    arg = arguments.parse()
    chart = chartt.Chart(chart=arg.chart)
    journal = journalt.Journal(arg.journal)
    initial = initialt.Initial(arg.initial)
    balance = balancet.Balance(chart, journal.entries(), initial,
                               arg.date_start, arg.date_end)

    tree = treet.Tree(chart)

    budget = budgett.Budget(arg.budget)
    ministry = ministryt.Ministry(coa=chart)

    if arg.dump_arguments:
        pprint(arg)
        return

    first_report = True

    if arg.bills:
        if not first_report:
            print "\f"
        first_report = False
        report_bills.bills_report(journal,
                                  arg.date_start, arg.date_end,
                                  arg.posted_start, arg.posted_end,
                                  width=arg.width)

    if arg.subfunds:
        if not first_report:
            print "\f"
        first_report = False
        report_subfunds.subfund_report(arg.month_name, tree, chart, balance,
                                       width=arg.width)

    if arg.general:
        if not first_report:
            print "\f"
        first_report = False
        name = "General Fund"
        number = chart.number(name)
        general = tree.tree(number)
        summary.tree_summary(general, chart, balance, name, arg.month_name, arg.month_name, zeros=False)
        summary_budget.tree_summary(general, chart, balance, budget, name, arg.month_name, zeros=False)

    if arg.ministries:
        if not first_report:
            print "\f"
        first_report = False
        report_ministry.ministry_reports(chart, tree, journal, budget, balance,
                                         ministry, arg.month_name,
                                         arg.date_start, arg.date_end,
                                         arg.posted_start, arg.posted_end,
                                         width=arg.width)

    if arg.vendors:
        if not first_report:
            print "\f"
        first_report = False
        report_vendors.vendor_report(chart, journal, balance,
                                     arg.date_start, arg.date_end,
                                     all_vendors=arg.all_vendors,
                                     width=arg.width)

if __name__ == "__main__":
    main()
